!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).dawaAutocomplete={})}(this,(function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var n,r=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});let n="key";let r=!1,o=!1,s=!1;function i(e){if(!e)throw new Error("Expected value to be defined");return e}function u(e){if(!s)throw new Error("Cannot call "+e+"() unless in patch.")}function l(e){if(r)throw new Error(e+"() can not be called between elementOpenStart() and elementOpenEnd().")}function c(e){if(o)throw new Error(e+"() may not be called inside an element that has called skip().")}function a(e){if(!r)throw new Error(e+"() can only be called after calling elementOpenStart().")}function f(e){s=null!=e}function d(e){const t=r;return r=e,t}function p(e){const t=o;return o=e,t}const h=Object.prototype.hasOwnProperty;function g(){}function m(){return new g}function y(e,t){for(;e.length>t;)e.pop()}g.prototype=Object.create(null);const v={default:"__default"};function b(e,t,n){if(null==n)e.removeAttribute(t);else{const r=function(e){return 0===e.lastIndexOf("xml:",0)?"http://www.w3.org/XML/1998/namespace":0===e.lastIndexOf("xlink:",0)?"http://www.w3.org/1999/xlink":null}(t);r?e.setAttributeNS(r,t,String(n)):e.setAttribute(t,String(n))}}function w(e,t,n){e[t]=n}function k(e,t,n){t.indexOf("-")>=0?e.setProperty(t,n):e[t]=n}const x=m();function O(e,t,n){(x[t]||x[v.default])(e,t,n)}x[v.default]=function(e,t,n){const r=typeof n;"object"===r||"function"===r?w(e,t,n):b(e,t,n)},x.style=function(e,t,n){i("style"in e);const r=e.style;if("string"==typeof n)r.cssText=n;else{r.cssText="";for(const e in n)o=n,s=e,h.call(o,s)&&k(r,e,n[e])}var o,s};const C={nodesCreated:null,nodesDeleted:null};class R{constructor(){this.created=[],this.deleted=[]}markCreated(e){this.created.push(e)}markDeleted(e){this.deleted.push(e)}notifyChanges(){C.nodesCreated&&this.created.length>0&&C.nodesCreated(this.created),C.nodesDeleted&&this.deleted.length>0&&C.nodesDeleted(this.deleted)}}function _(e){return 1===e.nodeType}const A="undefined"!=typeof Node&&Node.prototype.getRootNode||function(){let e=this,t=e;for(;e;)t=e,e=e.parentNode;return t};function S(e,t){const n=function(e){const t=A.call(e);return function(e){return 11===e.nodeType||9===e.nodeType}(t)?t.activeElement:null}(e);return n&&e.contains(n)?function(e,t){const n=[];let r=e;for(;r!==t;){const e=i(r);n.push(e),r=e.parentNode}return n}(n,t):[]}class E{constructor(e,t,n){this._attrsArr=null,this.staticsApplied=!1,this.nameOrCtor=e,this.key=t,this.text=n}hasEmptyAttrsArr(){const e=this._attrsArr;return!e||!e.length}getAttrsArr(e){return this._attrsArr||(this._attrsArr=function(e){const t=new Array(e);return y(t,0),t}(e))}}function q(e,t,n,r){const o=new E(t,n,r);return e.__incrementalDOMData=o,o}function j(e,t){if(e.__incrementalDOMData)return e.__incrementalDOMData;const r=_(e)?e.localName:e.nodeName,o=n,s=_(e)&&null!=o?e.getAttribute(o):null,i=q(e,r,_(e)?s||t:null);return _(e)&&function(e,t){const n=e.attributes,r=n.length;if(!r)return;const o=t.getAttrsArr(r);for(let e=0,t=0;e<r;e+=1,t+=2){const r=n[e],s=r.name,i=r.value;o[t]=s,o[t+1]=i}}(e,i),i}function D(e,t){return j(e,t)}function N(e,t,n,r){let o;if("function"==typeof n)o=new n;else{const r=function(e,t){return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/Math/MathML":null==t||"foreignObject"===D(t).nameOrCtor?null:t.namespaceURI}(n,t);o=r?e.createElementNS(r,n):e.createElement(n)}return q(o,n,r),o}function T(e,t,n,r,o){return t==n&&r==o}let I=null,P=null,L=null,M=null,z=[],U=T,W=[],B=[];function F(){return W}function $(){return B}function K(e,t,n){const r=D(e,n);return U(e,t,r.nameOrCtor,n,r.key)}function H(e,t,n){const r=e;let o=t;for(;o!==n;){const e=o.nextSibling;r.removeChild(o),I.markDeleted(o),o=e}}function V(){return P?P.nextSibling:L.firstChild}function X(){L=P,P=null}function J(){H(L,V(),null),P=L,L=L.parentNode}function G(){P=V()}function Q(e,t){let n;return n="#text"===e?function(e){const t=e.createTextNode("");return q(t,"#text",null),t}(M):N(M,L,e,t),I.markCreated(n),n}function Y(e,t){G();const n=function(e,t,n){if(!e)return null;let r=e;do{if(K(r,t,n))return r}while(n&&(r=r.nextSibling));return null}(P,e,t)||Q(e,t);n!==P&&(z.indexOf(n)>=0?function(e,t,n){const r=t.nextSibling;let o=n;for(;null!==o&&o!==t;){const t=o.nextSibling;e.insertBefore(o,r),o=t}}(L,n,P):L.insertBefore(n,P),P=n)}function Z(e,t){return Y(e,t),X(),L}function ee(){return p(!1),J(),P}function te(){return Y("#text",null),P}function ne(){return u("currentElement"),l("currentElement"),L}function re(e,t={}){const{matches:n=T}=t;return(t,o,s)=>{const i=I,u=M,l=z,c=W,a=B,h=P,g=L,m=U;let y=!1,v=!1;M=t.ownerDocument,I=new R,U=n,W=[],B=[],P=null,L=t.parentNode,z=S(t,L),y=d(!1),v=p(!1),f(I);try{const n=e(t,o,s);return function(){if(r)throw new Error("elementOpenEnd() must be called after calling elementOpenStart().")}(),n}finally{I.notifyChanges(),M=u,I=i,U=m,W=c,B=a,P=h,L=g,z=l,d(y),p(v),f(I)}}}function oe(e){return re((e,t,n)=>(P=e,X(),t(n),J(),function(e,t){if(e===t)return;let n=e;const r=[];for(;n&&n!==t;)r.push(n.nodeName.toLowerCase()),n=n.parentNode;throw new Error("One or more tags were not closed:\n"+r.join("\n"))}(P,e),e),e)}function se(e){return re((e,t,n)=>{const r={nextSibling:e};let o=null,s=null;return o=e.nextSibling,s=e.previousSibling,P=r,t(n),L||console.warn("patchOuter requires the node have a parent if there is a key."),function(e,t,n,r){const o=i(e),s=i(t),u=s.nextSibling===n&&s.previousSibling===r,l=s.nextSibling===o.nextSibling&&s.previousSibling===r;if(!u&&!l&&!(s===o))throw new Error("There must be exactly one top level call corresponding to the patched element.")}(r,P,o,s),L&&H(L,V(),e.nextSibling),r===P?null:P},e)}const ie=oe(),ue=se(),le=[];let ce=0;function ae(e,t,n,r){le.push(e),le.push(t),le.push(n),le.push(r)}const fe=m();function de(e,t,n,r){const o=!e.length;let s=0;for(;s<t.length;s+=2){const i=t[s];if(o)e[s]=i;else if(e[s]!==i)break;const u=t[s+1];(o||e[s+1]!==u)&&(e[s+1]=u,ae(r,n,i,u))}if(s<t.length||s<e.length){const o=s;for(s=o;s<e.length;s+=2)fe[e[s]]=e[s+1];for(s=o;s<t.length;s+=2){const o=t[s],i=t[s+1];fe[o]!==i&&ae(r,n,o,i),e[s]=o,e[s+1]=i,delete fe[o]}y(e,t.length);for(const e in fe)ae(r,n,e,void 0),delete fe[e]}!function(){const e=ce,t=le.length;ce=t;for(let n=e;n<t;n+=4){(0,le[n])(le[n+1],le[n+2],le[n+3])}ce=e,y(le,e)}()}const pe=m();function he(e,t){const n=$();de(t.getAttrsArr(n.length),n,e,O),y(n,0)}function ge(e,t,n){if(t.staticsApplied)return;if(t.staticsApplied=!0,!n||!n.length)return;if(t.hasEmptyAttrsArr()){for(let t=0;t<n.length;t+=2)O(e,n[t],n[t+1]);return}for(let e=0;e<n.length;e+=2)pe[n[e]]=e+1;const r=t.getAttrsArr(0);let o=0;for(let e=0;e<r.length;e+=2){const t=r[e],s=r[e+1],i=pe[t];i?n[i]===s&&delete pe[t]:(r[o]=t,r[o+1]=s,o+=2)}y(r,o);for(const t in pe)O(e,t,n[pe[t]]),delete pe[t]}function me(e,t,n){const r=F();l("elementOpenStart"),d(!0),r[0]=e,r[1]=t,r[2]=n}function ye(e,t){const n=$();u("attr"),n.push(e),n.push(t)}function ve(){const e=F();a("elementOpenEnd"),d(!1);const t=Z(e[0],e[1]),n=D(t);return ge(t,n,e[2]),he(t,n),y(e,0),t}function be(e,t,n,...r){l("elementOpen"),c("elementOpen"),me(e,t,n);for(let e=3;e<arguments.length;e+=2)ye(arguments[e],arguments[e+1]);return ve()}function we(e){l("elementClose");const t=ee();return function(e,t){if(e!==t)throw new Error('Received a call to close "'+t+'" but "'+e+'" was open.')}(D(t).nameOrCtor,e),t}t.applyAttr=b,t.applyProp=w,t.attributes=x,t.alignWithDOM=Y,t.close=ee,t.createPatchInner=oe,t.createPatchOuter=se,t.currentElement=ne,t.currentPointer=function(){return u("currentPointer"),l("currentPointer"),V()},t.open=Z,t.patch=ie,t.patchInner=ie,t.patchOuter=ue,t.skip=function(){!function(e,t){if(null!==t)throw new Error(e+"() must come before any child declarations inside the current element.")}("skip",P),p(!0),P=L.lastChild},t.skipNode=G,t.setKeyAttributeName=function(e){n=e},t.clearCache=function e(t){t.__incrementalDOMData=null;for(let n=t.firstChild;n;n=n.nextSibling)e(n)},t.getKey=function(e){return i(e.__incrementalDOMData),D(e).key},t.importNode=function e(t){j(t);for(let n=t.firstChild;n;n=n.nextSibling)e(n)},t.isDataInitialized=function(e){return Boolean(e.__incrementalDOMData)},t.notifications=C,t.symbols=v,t.applyAttrs=function(){const e=ne();he(e,D(e))},t.applyStatics=function(e){const t=ne();ge(t,D(t),e)},t.attr=ye,t.elementClose=we,t.elementOpen=be,t.elementOpenEnd=ve,t.elementOpenStart=me,t.elementVoid=function(e,t,n,...r){return be.apply(null,arguments),we(e)},t.key=function(e){const t=F();a("key"),i(t),t[1]=e},t.text=function(e,...t){l("text"),c("text");const n=te(),r=D(n);if(r.text!==e){r.text=e;let t=e;for(let e=1;e<arguments.length;e+=1){t=(0,arguments[e])(t)}n.data!==t&&(n.data=t)}return n}}));(n=r)&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")&&n.default;r.applyAttr;var o=r.applyProp,s=r.attributes,i=(r.alignWithDOM,r.close,r.createPatchInner,r.createPatchOuter,r.currentElement,r.currentPointer,r.open,r.patch),u=(r.patchInner,r.patchOuter,r.skip,r.skipNode,r.setKeyAttributeName,r.clearCache,r.getKey,r.importNode,r.isDataInitialized,r.notifications,r.symbols,r.applyAttrs,r.applyStatics,r.attr,r.elementClose),l=r.elementOpen,c=(r.elementOpenEnd,r.elementOpenStart,r.elementVoid),a=(r.key,r.text);s.caretpos=function(e,t,n){e.setSelectionRange(n,n)},s.value=o;var f=function(e,t,n,r){i(e,(function(){!function(e,t,n){if(e.suggestions.length>0&&e.focused){l("ul","",["class","dawa-autocomplete-suggestions","role","listbox","unselectable","on"]);for(var r=function(r){var o=e.suggestions[r],s="dawa-autocomplete-suggestion";e.selected===r&&(s+=" dawa-selected"),l("li","",["role","option"],"class",s,"onmousedown",(function(e){t(r),e.preventDefault()}));var i=o.forslagstekst.split("\n");if(i=i.map((function(e){return e.replace(/ /g," ")})),n){a(i[0]);for(var f=1;f<i.length;++f)c("br"),a(i[f])}else a(i.join(", "));u("li")},o=0;o<e.suggestions.length;++o)r(o);u("ul")}}(t,n,r)}))},d=function(e,t){var n=t.onSelect,r=t.onTextChange,o=t.render||f,s=!1,u="",l=0,c=document.createElement("div");e.parentNode.insertBefore(c,e.nextSibling);var a,d={caretpos:2,inputText:"",selected:0,focused:document.activeElement===e,suggestions:[]},p=function(e){var t=e.value,n=e.selectionStart;d.caretpos=n,d.inputText=t,function(e,t){u===e&&l===t||(r(e,t),u=e,l=t)}(t,n)},h=function(e){var t=d.suggestions[e];d.inputText=t.tekst,d.caretpos=t.caretpos,d.suggestions=[],n(t),a(!0)},g=function(e){var t=window.event?e.keyCode:e.which;if(d.suggestions.length>0&&d.focused){if(40===t)d.selected=(d.selected+1)%d.suggestions.length,a();else if(38===t)d.selected=(d.selected-1+d.suggestions.length)%d.suggestions.length,a();else{if(13!==t&&9!==t)return!0;h(d.selected)}return e.preventDefault(),!1}},m=function(){d.focused=!0,a()},y=function(){return d.focused=!1,a(),!1},v=function(e){p(e.target)},b=function(e){return p(e.target)},w=!1,k=!1;(a=function(n){n&&(k=!0),w||(w=!0,requestAnimationFrame((function(){s||(w=!1,k&&(e.value=d.inputText,e.setSelectionRange(d.caretpos,d.caretpos)),k=!1,o(c,d,(function(e){return h(e)}),t.multiline))})))})();return e.addEventListener("keydown",g),e.addEventListener("blur",y),e.addEventListener("focus",m),e.addEventListener("input",v),e.addEventListener("mouseup",b),e.setAttribute("aria-autocomplete","list"),e.setAttribute("autocomplete","off"),{destroy:function(){s=!0,e.removeEventListener("keydown",g),e.removeEventListener("blur",y),e.removeEventListener("focus",m),e.removeEventListener("input",v),e.removeEventListener("mouseup",b),i(c,(function(){})),c.remove()},setSuggestions:function(e){d.suggestions=e,d.selected=0,a()},selectAndClose:function(e){d.inputText=e,d.caretpos=e.length,d.suggestions=[],d.selected=0,a(!0)}}};function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h={params:{},minLength:2,retryDelay:500,renderCallback:function(){console.error("No renderCallback supplied")},initialRenderCallback:function(){console.error("No initialRenderCallback supplied")},type:"adresse",baseUrl:"https://api.dataforsyningen.dk",adgangsadresserOnly:!1,stormodtagerpostnumre:!0,supplerendebynavn:!0,fuzzy:!0,fetchImpl:function(e,t){return(n="".concat(e,"?").concat(function(e){return Object.keys(e).map((function(t){var n=e[t];return"".concat(t,"=").concat(encodeURIComponent(n))})).join("&")}(t)),r={mode:"cors"},r=r||{},new Promise((function(e,t){var o=new XMLHttpRequest,s=[],i=[],u={},l=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:l,headers:{keys:function(){return s},entries:function(){return i},get:function(e){return u[e.toLowerCase()]},has:function(e){return e.toLowerCase()in u}}}};for(var c in o.open(r.method||"get",n,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){s.push(t=t.toLowerCase()),i.push([t,n]),u[t]=u[t]?u[t]+","+n:n})),e(l())},o.onerror=t,o.withCredentials="include"==r.credentials,r.headers)o.setRequestHeader(c,r.headers[c]);o.send(r.body||null)}))).then((function(e){return e.json()}));var n,r}},g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Object.assign({},h,t||{}),this.options=t,this.state={currentRequest:null,pendingRequest:null},this.selected=null}var t,n,r;return t=e,(n=[{key:"_getAutocompleteResponse",value:function(e,t,n,r,o,s){var i=Object.assign({},this.options.params,{q:e,type:this.options.type,caretpos:t,supplerendebynavn:o,stormodtagerpostnumre:s,multilinje:!0});return this.options.fuzzy&&(i.fuzzy=""),r&&(i.adgangsadresseid=r),n&&(i.startfra="adgangsadresse"),this.options.fetchImpl("".concat(this.options.baseUrl,"/autocomplete"),i)}},{key:"_scheduleRequest",value:function(e){null!==this.state.currentRequest?this.state.pendingRequest=e:(this.state.currentRequest=e,this._executeRequest())}},{key:"_executeRequest",value:function(){var e,t,n=this,r=this.state.currentRequest,o=null,s=!1;if(r.selected){var i=r.selected;if(i.type===this.options.type)return this.options.selectCallback(i),this.selected=i,void this._requestCompleted();o="adgangsadresse"===i.type?i.data.id:null,s="vejnavn"===i.type,e=i.tekst,t=i.caretpos}else e=r.text,t=r.caretpos;if(r.selectedId){var u={id:r.selectedId,type:this.options.type};return this.options.fetchImpl("".concat(this.options.baseUrl,"/autocomplete"),u).then((function(e){return n._handleResponse(r,e)}),(function(e){return n._handleFailedRequest(r,e)}))}r.selected||r.text.length>=this.options.minLength?this._getAutocompleteResponse(e,t,s,o,this.options.supplerendebynavn,this.options.stormodtagerpostnumre).then((function(e){return n._handleResponse(r,e)}),(function(e){return n._handleFailedRequest(r,e)})):this._handleResponse(r,[])}},{key:"_handleFailedRequest",value:function(e,t){var n,r=this;return console.error("DAWA request failed",t),(n=this.options.retryDelay,new Promise((function(e){return setTimeout(e,n)}))).then((function(){r.state.pendingRequest||r._scheduleRequest(e),r._requestCompleted()}))}},{key:"_handleResponse",value:function(e,t){if(e.selected)if(1===t.length){var n=t[0];n.type===this.options.type?this.options.selectCallback(n):this.state.pendingRequest||(this.state.pendingRequest={selected:n})}else this.options.renderCallback&&this.options.renderCallback(t);else e.selectedId?1===t.length&&(this.selected=t[0],this.options.initialRenderCallback(t[0].tekst)):this.options.renderCallback&&this.options.renderCallback(t);this._requestCompleted()}},{key:"_requestCompleted",value:function(){this.state.currentRequest=this.state.pendingRequest,this.state.pendingRequest=null,this.state.currentRequest&&this._executeRequest()}},{key:"setRenderCallback",value:function(e){this.options.renderCallback=e}},{key:"setInitialRenderCallback",value:function(e){this.options.initialRenderCallback=e}},{key:"setSelectCallback",value:function(e){this.options.selectCallback=e}},{key:"update",value:function(e,t){var n={text:e,caretpos:t};this._scheduleRequest(n)}},{key:"select",value:function(e){var t={selected:e};this._scheduleRequest(t)}},{key:"selectInitial",value:function(e){var t={selectedId:e};this._scheduleRequest(t)}},{key:"destroy",value:function(){}}])&&p(t.prototype,n),r&&p(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),m=/^\s+|\s+$/g,y=/^[-+]0x[0-9a-f]+$/i,v=/^0b[01]+$/i,b=/^0o[0-7]+$/i,w=parseInt,k="object"==typeof t&&t&&t.Object===Object&&t,x="object"==typeof self&&self&&self.Object===Object&&self,O=k||x||Function("return this")(),C=Object.prototype.toString,R=Math.max,_=Math.min,A=function(){return O.Date.now()};function S(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function E(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==C.call(e)}(e))return NaN;if(S(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=S(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(m,"");var n=v.test(e);return n||b.test(e)?w(e.slice(2),n?2:8):y.test(e)?NaN:+e}var q=function(e,t,n){var r,o,s,i,u,l,c=0,a=!1,f=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,s=o;return r=o=void 0,c=t,i=e.apply(s,n)}function h(e){return c=e,u=setTimeout(m,t),a?p(e):i}function g(e){var n=e-l;return void 0===l||n>=t||n<0||f&&e-c>=s}function m(){var e=A();if(g(e))return y(e);u=setTimeout(m,function(e){var n=t-(e-l);return f?_(n,s-(e-c)):n}(e))}function y(e){return u=void 0,d&&r?p(e):(r=o=void 0,i)}function v(){var e=A(),n=g(e);if(r=arguments,o=this,l=e,n){if(void 0===u)return h(l);if(f)return u=setTimeout(m,t),p(l)}return void 0===u&&(u=setTimeout(m,t)),i}return t=E(t)||0,S(n)&&(a=!!n.leading,s=(f="maxWait"in n)?R(E(n.maxWait)||0,t):s,d="trailing"in n?!!n.trailing:d),v.cancel=function(){void 0!==u&&clearTimeout(u),c=0,r=l=o=u=void 0},v.flush=function(){return void 0===u?i:y(A())},v};e.dawaAutocomplete=function(e,t){t=Object.assign({select:function(){return null}},t);var n=["baseUrl","minLength","params","fuzzy","stormodtagerpostnumre","supplerendebynavn","type"].reduce((function(e,n){return t.hasOwnProperty(n)&&(e[n]=t[n]),e}),{});n.type||(t.adgangsadresserOnly?n.type="adgangsadresse":n.type="adresse");var r=new g(n),o=function(e,t){return r.update(e,t)};o=t.debounce?q(o,t.debounce,{maxWait:500}):o;var s=d(e,{onSelect:function(e){r.select(e)},onTextChange:o,render:t.render,multiline:t.multiline||!1});return r.setRenderCallback((function(e){return s.setSuggestions(e)})),r.setSelectCallback((function(e){s.selectAndClose(e.tekst),t.select(e)})),r.setInitialRenderCallback((function(e){return s.selectAndClose(e)})),t.id&&r.selectInitial(t.id),{id:function(e){return r.selectInitial(e)},destroy:function(){return s.destroy()},selected:function(){return r.selected}}},Object.defineProperty(e,"__esModule",{value:!0})}));
